<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ÊñáÂçïËØçÂê¨ÂÜô - Âê¨Èü≥ÂÜôÂçïËØç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
            background: linear-gradient(135deg, #F5E6F0 0%, #E8DDF0 50%, #F0E6F5 100%);
            min-height: 100vh;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow: hidden;
        }

        .container {
            background: linear-gradient(to bottom, #ffffff 0%, #FAF7FC 100%);
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(200, 150, 200, 0.15);
            max-width: 500px;
            width: 100%;
            height: calc(100vh - 20px);
            overflow: hidden;
            border: 3px solid #E8D5E8;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #D8A8D8 0%, #E8C8E8 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            flex-shrink: 0;
        }

        .header::before {
            content: "‚ú®";
            position: absolute;
            left: 20px;
            top: 15px;
            font-size: 24px;
            animation: twinkle 2s infinite;
        }

        .header::after {
            content: "‚ú®";
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            animation: twinkle 2s infinite 1s;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.95;
        }

        .content {
            padding: 20px 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* È°µÈù¢ÂàáÊç¢ */
        .page {
            display: none;
        }

        .page.active {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        /* È¶ñÈ°µÊ†∑Âºè */
        .unit-selector {
            margin-bottom: 30px;
        }

        .unit-selector label {
            display: block;
            font-size: 16px;
            color: #C89AB8;
            margin-bottom: 16px;
            font-weight: 700;
            text-align: center;
        }

        .unit-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .unit-btn {
            padding: 20px 12px;
            border: 2px solid #E8D5E8;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 600;
            color: #C89AB8;
            box-shadow: 0 4px 15px rgba(200, 154, 184, 0.1);
        }

        .unit-btn:hover {
            border-color: #C89AB8;
            background: #F7F0F7;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(200, 154, 184, 0.15);
        }

        .unit-btn.active {
            background: linear-gradient(135deg, #C89AB8 0%, #D8C5D8 100%);
            color: white;
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(200, 154, 184, 0.2);
        }

        .unit-icon {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
            animation: bounce 0.6s ease-in-out;
        }

        .unit-btn.active .unit-icon {
            animation: bounce 0.6s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .count-selector {
            margin-bottom: 30px;
        }

        .count-selector label {
            display: block;
            font-size: 16px;
            color: #C89AB8;
            margin-bottom: 16px;
            font-weight: 700;
            text-align: center;
        }

        .count-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .count-btn {
            padding: 14px;
            border: 2px solid #E8D5E8;
            border-radius: 18px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 700;
            color: #C89AB8;
            box-shadow: 0 4px 15px rgba(200, 154, 184, 0.1);
        }

        .count-btn:hover {
            border-color: #C89AB8;
            background: #F7F0F7;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(200, 154, 184, 0.15);
        }

        .count-btn.active {
            background: linear-gradient(135deg, #C89AB8 0%, #D8C5D8 100%);
            color: white;
            border-color: transparent;
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(200, 154, 184, 0.2);
        }

        .start-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #C89AB8 0%, #D8C5D8 100%);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 6px 20px rgba(200, 154, 184, 0.2);
            letter-spacing: 1px;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(200, 154, 184, 0.3);
        }

        .start-btn:active {
            transform: translateY(-1px);
        }

        /* Âê¨ÂÜôÈ°µÈù¢Ê†∑Âºè */
        .progress-bar {
            margin-bottom: 30px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            color: #C89AB8;
            font-weight: 600;
        }

        .progress-fill {
            height: 8px;
            background: #E8E0E8;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill-inner {
            height: 100%;
            background: linear-gradient(90deg, #C89AB8 0%, #D8C5D8 100%);
            width: 0%;
            transition: width 0.4s ease;
            border-radius: 10px;
        }

        .word-display {
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .word-number {
            font-size: 14px;
            color: #D8C5D8;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .chinese-word {
            font-size: 56px;
            font-weight: 700;
            color: #C89AB8;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(255, 133, 192, 0.1);
        }

        .phonetic {
            font-size: 16px;
            color: #D8C5D8;
            margin-bottom: 20px;
            font-style: italic;
            font-weight: 500;
        }

        .play-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #C89AB8 0%, #D8C5D8 100%);
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.8);
            font-size: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            box-shadow: 0 8px 30px rgba(200, 154, 184, 0.2);
        }

        .play-btn:hover {
            transform: scale(1.12);
            box-shadow: 0 12px 40px rgba(200, 154, 184, 0.3);
        }

        .play-btn:active {
            transform: scale(0.98);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        /* ÂÄíËÆ°Êó∂Ê†∑Âºè */
        .countdown-container {
            margin-top: 20px;
            text-align: center;
        }

        .countdown-bar {
            height: 6px;
            background: #E8E0E8;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .countdown-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, #C89AB8 0%, #D8C5D8 100%);
            width: 100%;
            transition: width 0.1s linear;
            border-radius: 3px;
        }

        .countdown-text {
            font-size: 14px;
            color: #C89AB8;
            font-weight: 600;
        }

        .btn {
            padding: 14px;
            border: 2px solid #E8D5E8;
            border-radius: 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary {
            background: white;
            color: #C89AB8;
            border-color: #C89AB8;
            box-shadow: 0 4px 12px rgba(200, 154, 184, 0.1);
        }

        .btn-secondary:hover {
            background: #F7F0F7;
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(200, 154, 184, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #C89AB8 0%, #D8C5D8 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(200, 154, 184, 0.15);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(200, 154, 184, 0.25);
        }

        /* ÁªìÊûúÈ°µÈù¢Ê†∑Âºè */
        .result-card {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #F7F0F7 0%, #E8DFE8 100%);
            border-radius: 25px;
            border: 2px solid #D8C5D8;
        }

        .result-title {
            font-size: 28px;
            color: #C89AB8;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .result-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            padding: 16px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(200, 154, 184, 0.1);
        }

        .stat-label {
            font-size: 12px;
            color: #D8C5D8;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #C89AB8;
        }

        .result-list {
            text-align: left;
            max-height: 320px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            background: white;
            border-radius: 16px;
            border: 1px solid #E8DFE8;
        }

        .result-item {
            padding: 14px;
            border-bottom: 1px solid #E8DFE8;
            font-size: 14px;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-english {
            color: #C89AB8;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .result-phonetic {
            color: #D8C5D8;
            font-size: 12px;
            font-style: italic;
            margin-bottom: 4px;
        }

        .result-chinese {
            color: #666;
            font-weight: 500;
        }

        .button-group-large {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 480px) {
            body {
                padding: 15px;
            }

            .container {
                border-radius: 25px;
                border-width: 2px;
            }

            .header {
                padding: 30px 15px;
            }

            .header h1 {
                font-size: 26px;
            }

            .content {
                padding: 20px 15px;
            }

            .chinese-word {
                font-size: 48px;
            }

            .play-btn {
                width: 120px;
                height: 120px;
                font-size: 60px;
            }

            .result-stats {
                grid-template-columns: 1fr;
            }

            .unit-buttons,
            .count-buttons {
                gap: 10px;
            }

            .unit-btn,
            .count-btn {
                padding: 16px 8px;
                font-size: 12px;
            }

            .start-btn {
                padding: 14px;
                font-size: 16px;
            }

            .btn {
                padding: 12px;
                font-size: 14px;
            }

            .button-group.three-cols {
                grid-template-columns: 1fr 1fr 1fr;
                gap: 8px;
            }

            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 20px;
                margin-bottom: 4px;
            }

            .header p {
                font-size: 12px;
            }

            .content {
                padding: 12px 12px;
                flex: 1;
                display: flex;
                flex-direction: column;
            }

            .progress-bar {
                margin-bottom: 12px;
            }

            .word-display {
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            .word-number {
                margin-bottom: 10px;
                font-size: 12px;
            }

            .chinese-word {
                font-size: 36px;
                margin-bottom: 8px;
            }

            .phonetic {
                font-size: 14px;
                margin-bottom: 15px;
            }

            .play-btn {
                width: 80px;
                height: 80px;
                font-size: 40px;
            }

            .countdown-container {
                margin-top: 15px;
            }

            .countdown-text {
                font-size: 12px;
            }

            .btn {
                padding: 10px 5px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ëã±ÊñáÂçïËØçÂê¨ÂÜô</h1>
            <p>Âê¨Èü≥È¢ëÔºåÁî®Á¨îÂÜôÂçïËØç</p>
        </div>

        <div class="content">
            <!-- È¶ñÈ°µ -->
            <div id="homePage" class="page active">
                <div class="unit-selector">
                    <label>ÈÄâÊã©Â≠¶‰π†ÂçïÂÖÉ</label>
                    <div class="unit-buttons">
                        <button class="unit-btn active" data-unit="unit1">
                            <span class="unit-icon">üìö</span>
                            <span>Unit 1</span>
                        </button>
                        <button class="unit-btn" data-unit="unit2">
                            <span class="unit-icon">üìñ</span>
                            <span>Unit 2</span>
                        </button>
                        <button class="unit-btn" data-unit="unit3">
                            <span class="unit-icon">‚úèÔ∏è</span>
                            <span>Unit 3</span>
                        </button>
                    </div>
                </div>

                <div class="count-selector">
                    <label>ÈÄâÊã©ÂçïËØçÊï∞Èáè</label>
                    <div class="count-buttons">
                        <button class="count-btn" data-count="5">5‰∏™</button>
                        <button class="count-btn active" data-count="10">10‰∏™</button>
                        <button class="count-btn" data-count="15">15‰∏™</button>
                    </div>
                </div>

                <button class="start-btn" id="startBtn">ÂºÄÂßãÂê¨ÂÜô</button>
            </div>

            <!-- Âê¨ÂÜôÈ°µÈù¢ -->
            <div id="dictationPage" class="page">
                <div class="progress-bar">
                    <div class="progress-info">
                        <span id="progressText">1/10</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-fill">
                        <div class="progress-fill-inner" id="progressFill"></div>
                    </div>
                </div>

                <div class="word-display">
                    <div class="word-number" id="wordNumber">Á¨¨ 1 ‰∏™ÂçïËØç</div>
                    <div class="chinese-word" id="chineseWord">Â¶àÂ¶à</div>
                    <div class="phonetic" id="phonetic">/Ààm å√∞…ôr/</div>
                    <button class="play-btn" id="playBtn" title="ÁÇπÂáªÊí≠ÊîæÂèëÈü≥">üîä</button>
                </div>

                <div class="countdown-container">
                    <div class="countdown-bar">
                        <div class="countdown-bar-inner" id="countdownBar"></div>
                    </div>
                    <div class="countdown-text" id="countdownText">15ÁßíÂêéËá™Âä®‰∏ã‰∏Ä‰∏™</div>
                </div>

                <div class="button-group three-cols" style="grid-template-columns: 1fr 1fr 1fr;">
                    <button class="btn btn-secondary" id="prevBtn">‰∏ä‰∏Ä‰∏™</button>
                    <button class="btn btn-secondary" id="homeBtn2" style="background: white; color: #C89AB8; border-color: #C89AB8;">ËøîÂõûÈ¶ñÈ°µ</button>
                    <button class="btn btn-primary" id="nextBtn">‰∏ã‰∏Ä‰∏™</button>
                </div>
            </div>

            <!-- ÁªìÊûúÈ°µÈù¢ -->
            <div id="resultPage" class="page">
                <div class="result-card">
                    <div class="result-title">Âê¨ÂÜôÂÆåÊàêÔºÅ</div>
                    <div class="result-stats">
                        <div class="stat-item">
                            <div class="stat-label">ÊÄªÂçïËØçÊï∞</div>
                            <div class="stat-value" id="totalCount">10</div>
                        </div>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px; color: #333;">ÂçïËØçÊ±áÊÄª</h3>
                <div class="result-list" id="resultList"></div>

                <div class="button-group-large">
                    <button class="btn btn-secondary" id="againBtn">ÂÜçÊù•‰∏ÄÊ¨°</button>
                    <button class="btn btn-primary" id="homeBtn">ËøîÂõûÈ¶ñÈ°µ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Áä∂ÊÄÅÁÆ°ÁêÜ
        let state = {
            selectedUnit: "unit1",
            selectedCount: 10,
            currentWordIndex: 0,
            words: [],
            unitData: {}
        };

        // ÂÄíËÆ°Êó∂Áõ∏ÂÖ≥
        const COUNTDOWN_SECONDS = 15;
        let countdownTimer = null;
        let countdownInterval = null;
        let remainingTime = COUNTDOWN_SECONDS;
        let autoPlayEnabled = true; // ÊòØÂê¶ÂêØÁî®Ëá™Âä®Êí≠ÊîæÔºà10Áßí„ÄÅ5ÁßíÊó∂Ôºâ

        // ‰ªéJSONÊñá‰ª∂Âä†ËΩΩÂçïËØçÊï∞ÊçÆ
        async function loadUnitData(unitName) {
            try {
                const response = await fetch(`${unitName}.json`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log(`Successfully loaded ${unitName}.json with ${data.words.length} words`);
                return data;
            } catch (error) {
                console.error(`Failed to load ${unitName}.json:`, error);
                // Â¶ÇÊûúÂä†ËΩΩÂ§±Ë¥•ÔºåËøîÂõûÁ©∫Êï∞ÊçÆÁªìÊûÑ‰ª•ÈÅøÂÖçÂ∫îÁî®Â¥©Ê∫É
                return { id: unitName, name: unitName, words: [] };
            }
        }

        // ÂàùÂßãÂåñÂä†ËΩΩÊâÄÊúâÂçïÂÖÉÊï∞ÊçÆ
        async function initializeUnits() {
            try {
                state.unitData.unit1 = await loadUnitData("unit1");
                state.unitData.unit2 = await loadUnitData("unit2");
                state.unitData.unit3 = await loadUnitData("unit3");

                // Ê£ÄÊü•ÊòØÂê¶ÊàêÂäüÂä†ËΩΩ
                const loadedUnits = Object.entries(state.unitData)
                    .filter(([key, data]) => data && data.words && data.words.length > 0)
                    .map(([key]) => key);
                console.log("Successfully loaded units:", loadedUnits);

                // Â¶ÇÊûúunit1ÊúâÊï∞ÊçÆÔºåÂà∑Êñ∞ÊòæÁ§∫
                if (state.unitData.unit1 && state.unitData.unit1.words.length > 0) {
                    console.log("Unit1 data is ready");
                }
            } catch (error) {
                console.error("Error during initialization:", error);
            }
        }

        // DOM ÂÖÉÁ¥†
        const pages = {
            home: document.getElementById("homePage"),
            dictation: document.getElementById("dictationPage"),
            result: document.getElementById("resultPage")
        };

        // ÂàùÂßãÂåñ
        async function init() {
            await initializeUnits();
            setupEventListeners();
        }

        // ‰∫ã‰ª∂ÁõëÂê¨
        function setupEventListeners() {
            // È¶ñÈ°µ
            document.querySelectorAll(".unit-btn").forEach(btn => {
                btn.addEventListener("click", () => selectUnit(btn.dataset.unit, btn));
            });

            document.querySelectorAll(".count-btn").forEach(btn => {
                btn.addEventListener("click", () => selectCount(btn.dataset.count, btn));
            });

            document.getElementById("startBtn").addEventListener("click", startDictation);

            // Âê¨ÂÜôÈ°µÈù¢
            document.getElementById("playBtn").addEventListener("click", playSound);
            document.getElementById("nextBtn").addEventListener("click", nextWord);
            document.getElementById("prevBtn").addEventListener("click", prevWord);
            document.getElementById("homeBtn2").addEventListener("click", goHome);

            // ÁªìÊûúÈ°µÈù¢
            document.getElementById("againBtn").addEventListener("click", startDictation);
            document.getElementById("homeBtn").addEventListener("click", goHome);
        }

        // È¶ñÈ°µÈÄªËæë
        function selectUnit(unit, btn) {
            state.selectedUnit = unit;
            document.querySelectorAll(".unit-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
        }

        function selectCount(count, btn) {
            state.selectedCount = parseInt(count);
            document.querySelectorAll(".count-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
        }

        // ÂºÄÂßãÂê¨ÂÜô
        function startDictation() {
            const unitData = state.unitData[state.selectedUnit];

            console.log("Start dictation with unit:", state.selectedUnit);
            console.log("Unit data:", unitData);

            if (!unitData || !unitData.words || unitData.words.length === 0) {
                alert(`Êó†Ê≥ïÂä†ËΩΩ ${state.selectedUnit} ÁöÑÂçïËØçÊï∞ÊçÆÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÂêéÈáçËØï`);
                return;
            }

            const allWords = unitData.words;
            state.currentWordIndex = 0;

            console.log(`Total words in unit: ${allWords.length}, selected count: ${state.selectedCount}`);

            // ÈöèÊú∫ÈÄâÊã©ÂçïËØç
            const shuffled = [...allWords].sort(() => Math.random() - 0.5);
            state.words = shuffled.slice(0, state.selectedCount);

            console.log("Selected words:", state.words);

            showPage("dictation");
            displayWord(0);
        }

        // ÊòæÁ§∫ÂçïËØç
        function displayWord(index) {
            state.currentWordIndex = index;
            const word = state.words[index];

            document.getElementById("wordNumber").textContent = `Á¨¨ ${index + 1} ‰∏™ÂçïËØç`;
            document.getElementById("chineseWord").textContent = word.chinese;
            document.getElementById("phonetic").textContent = word.phonetic;

            // Êõ¥Êñ∞ËøõÂ∫¶
            const progress = ((index + 1) / state.words.length) * 100;
            document.getElementById("progressFill").style.width = progress + "%";
            document.getElementById("progressText").textContent = `${index + 1}/${state.words.length}`;
            document.getElementById("progressPercent").textContent = Math.round(progress) + "%";

            // Êõ¥Êñ∞ÊåâÈíÆ
            document.getElementById("prevBtn").disabled = index === 0;

            // Ëá™Âä®Êí≠ÊîæÔºàÂºÄÂßãÊó∂Êí≠Êîæ‰∏ÄÊ¨°Ôºâ
            setTimeout(() => playSoundAuto(), 300);

            // ÂêØÂä®ÂÄíËÆ°Êó∂
            startCountdown();
        }

        // Èü≥È¢ëÂØπË±°ÔºàÁî®‰∫éÊúâÈÅìËØçÂÖ∏ÂèëÈü≥Ôºâ
        let audioPlayer = null;

        // Êí≠ÊîæÂèëÈü≥ÔºàÊ†∏ÂøÉÂáΩÊï∞Ôºâ
        function playSoundCore() {
            if (!state.words || state.words.length === 0) {
                console.error("No words loaded");
                return;
            }

            const word = state.words[state.currentWordIndex];
            if (!word) {
                console.error("Word not found at index", state.currentWordIndex);
                return;
            }

            console.log("Playing word:", word.english);

            // ‰ΩøÁî®ÊúâÈÅìËØçÂÖ∏APIÊí≠ÊîæÂèëÈü≥ÔºàÁæéÈü≥Ôºâ
            const audioUrl = `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(word.english)}&type=1`;

            if (audioPlayer) {
                audioPlayer.pause();
            }
            audioPlayer = new Audio(audioUrl);
            audioPlayer.play().catch(e => {
                console.error("Audio play failed, fallback to speechSynthesis:", e);
                // Â¶ÇÊûúÊúâÈÅìAPIÂ§±Ë¥•ÔºåÂõûÈÄÄÂà∞ÊµèËßàÂô®TTS
                const utterance = new SpeechSynthesisUtterance(word.english);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            });
        }

        // Áî®Êà∑ÊâãÂä®ÁÇπÂáªÊí≠ÊîæÔºàÂèñÊ∂àÂêéÁª≠Ëá™Âä®Êí≠ÊîæÔºâ
        function playSound() {
            autoPlayEnabled = false; // ÂèñÊ∂à10Áßí„ÄÅ5ÁßíÁöÑËá™Âä®Êí≠Êîæ
            playSoundCore();
        }

        // Ëá™Âä®Êí≠ÊîæÔºàÂºÄÂßãÊó∂„ÄÅ10Áßí„ÄÅ5ÁßíÔºâ
        function playSoundAuto() {
            playSoundCore();
        }

        // ÂêØÂä®ÂÄíËÆ°Êó∂
        function startCountdown() {
            stopCountdown();
            remainingTime = COUNTDOWN_SECONDS;
            autoPlayEnabled = true; // ÈáçÁΩÆËá™Âä®Êí≠Êîæ
            let played10 = false;
            let played5 = false;
            updateCountdownDisplay();

            countdownInterval = setInterval(() => {
                remainingTime -= 0.1;
                updateCountdownDisplay();

                // Á¨¨10ÁßíÊó∂Êí≠ÊîæËØ≠Èü≥ÔºàÂ¶ÇÊûúËá™Âä®Êí≠ÊîæÊú™Ë¢´ÂèñÊ∂àÔºâ
                if (autoPlayEnabled && !played10 && remainingTime <= 10 && remainingTime > 9.9) {
                    played10 = true;
                    playSoundAuto();
                }

                // Á¨¨5ÁßíÊó∂Êí≠ÊîæËØ≠Èü≥ÔºàÂ¶ÇÊûúËá™Âä®Êí≠ÊîæÊú™Ë¢´ÂèñÊ∂àÔºâ
                if (autoPlayEnabled && !played5 && remainingTime <= 5 && remainingTime > 4.9) {
                    played5 = true;
                    playSoundAuto();
                }

                if (remainingTime <= 0) {
                    stopCountdown();
                    nextWord();
                }
            }, 100);
        }

        // ÂÅúÊ≠¢ÂÄíËÆ°Êó∂
        function stopCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
        }

        // Êõ¥Êñ∞ÂÄíËÆ°Êó∂ÊòæÁ§∫
        function updateCountdownDisplay() {
            const bar = document.getElementById("countdownBar");
            const text = document.getElementById("countdownText");
            const percent = (remainingTime / COUNTDOWN_SECONDS) * 100;
            bar.style.width = percent + "%";
            text.textContent = `${Math.ceil(remainingTime)}ÁßíÂêéËá™Âä®‰∏ã‰∏Ä‰∏™`;
        }

        // ‰∏ã‰∏Ä‰∏™ÂçïËØç
        function nextWord() {
            stopCountdown();
            if (state.currentWordIndex < state.words.length - 1) {
                displayWord(state.currentWordIndex + 1);
            } else {
                showResultPage();
            }
        }

        // ‰∏ä‰∏Ä‰∏™ÂçïËØç
        function prevWord() {
            stopCountdown();
            if (state.currentWordIndex > 0) {
                displayWord(state.currentWordIndex - 1);
            }
        }

        // ÈºìÂä±ËØ≠Ë®ÄÂ∫ì
        const encouragements = [
            "üéâ Â§™Ê£í‰∫ÜÔºÅ‰Ω†ÂÆåÊàêÂæóÁúüÊ£íÔºÅ",
            "‚≠ê ‰Ω†ÊòØ‰∏™Â∞èÂ§©ÊâçÔºÅÁªßÁª≠Âä†Ê≤πÔºÅ",
            "üí™ ‰Ω†ÂÅöÂæóÈùûÂ∏∏Âá∫Ëâ≤ÔºÅ‰∏∫Ëá™Â∑±È™ÑÂÇ≤ÂêßÔºÅ",
            "üåü ÁúüÂéâÂÆ≥ÔºÅ‰Ω†ËøõÊ≠•ÂæóÂæàÂø´ÔºÅ",
            "üòç ‰Ω†ÁöÑÂä™ÂäõË¢´ÁúãÂà∞‰∫ÜÔºÅÁªßÁª≠ÂùöÊåÅÔºÅ",
            "üéä ÊÅ≠Âñú‰Ω†ÔºÅ‰Ω†Â∑≤ÁªèÊéåÊè°‰∫ÜËøô‰∫õÂçïËØçÔºÅ",
            "‚ú® Ê£íÊûÅ‰∫ÜÔºÅ‰Ω†ÁöÑÂèëÈü≥ÂæàÊ†áÂáÜÔºÅ",
            "üèÜ ‰Ω†ÊòØÊúÄÊ£íÁöÑÂ≠¶‰π†ËÄÖÔºÅ",
            "üíñ Â•ΩÊ£íÂëÄÔºÅÂÜçÂä™Âäõ‰∏ÄÁÇπÂ∞±Êõ¥ÂÆåÁæé‰∫ÜÔºÅ",
            "üöÄ ‰Ω†ÂÉèÁÅ´ÁÆ≠‰∏ÄÊ†∑Âø´ÈÄüËøõÊ≠•ÔºÅ",
            "üëè ÊãçÊãçÊâãÔºÅ‰Ω†ÂÅöÂæóÈùûÂ∏∏Ê£íÔºÅ",
            "üåà ‰Ω†Â∞±ÂÉèÂΩ©Ëôπ‰∏ÄÊ†∑Èó™Èó™ÂèëÂÖâÔºÅ",
            "üéØ ÁõÆÊ†áËææÊàêÔºÅ‰Ω†ÁúüÁöÑÂæàÂéâÂÆ≥ÔºÅ",
            "üíù ‰Ω†ÁöÑÂùöÊåÅÂæàËÆ©‰∫∫ÊÑüÂä®ÔºÅÁªßÁª≠Âä†Ê≤πÔºÅ",
            "üå∫ ÁæéÂ•≥Âì¶ÔºÅ‰Ω†Â≠¶Ëã±ËØ≠ÁúüËÆ§ÁúüÔºÅ",
            "üé® ‰Ω†ÁöÑÂ≠¶‰π†ÊñπÂºèÂæàÊúâÂàõÊÑèÔºÅ",
            "‚ö° Âø´ÈÄüÂ≠¶‰π†ËÄÖÔºÅ‰Ω†ÂèçÂ∫îÁúüÊïèÊç∑ÔºÅ",
            "ü¶ã ‰Ω†ÂÉèËù¥Ëù∂‰∏ÄÊ†∑‰ºòÈõÖÂú∞ÊéåÊè°‰∫ÜÊñ∞Áü•ËØÜÔºÅ",
            "üåô Âç≥‰ΩøÂ§©Êôö‰∫ÜÔºå‰Ω†ËøòÂú®Âä™ÂäõÔºÅÁúüÂÄºÂæóËµûÊâ¨ÔºÅ",
            "‚òÄÔ∏è ‰Ω†Â∞±ÂÉèÂ§™Èò≥‰∏ÄÊ†∑Èó™ËÄÄÔºÅÁÖß‰∫Æ‰∫ÜÂ≠¶‰π†‰πãË∑ØÔºÅ"
        ];

        // ÊòæÁ§∫ÁªìÊûúÈ°µÈù¢
        function showResultPage() {
            stopCountdown();
            showPage("result");

            document.getElementById("totalCount").textContent = state.words.length;

            // Ê∏≤ÊüìÂçïËØçÂàóË°®
            const resultList = document.getElementById("resultList");
            resultList.innerHTML = "";

            state.words.forEach((word, index) => {
                const item = document.createElement("div");
                item.className = "result-item";
                item.innerHTML = `
                    <div class="result-english">${index + 1}. ${word.english}</div>
                    <div class="result-phonetic">${word.phonetic}</div>
                    <div class="result-chinese">${word.chinese}</div>
                `;
                resultList.appendChild(item);
            });

            // ÊòæÁ§∫ÈöèÊú∫ÈºìÂä±ËØ≠Ë®Ä
            const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
            const resultTitle = document.querySelector(".result-title");
            resultTitle.textContent = randomEncouragement;
        }

        // ËøîÂõûÈ¶ñÈ°µ
        function goHome() {
            stopCountdown();
            showPage("home");
        }

        // ÂàáÊç¢È°µÈù¢
        function showPage(pageName) {
            Object.values(pages).forEach(page => page.classList.remove("active"));
            pages[pageName].classList.add("active");
        }

        // ÂêØÂä®
        init();
    </script>
</body>
</html>
